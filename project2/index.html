<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Computer Science 291A</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
  </head>

  <body>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Computer Science 291A</a>
          </div>
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/lecture/">Lecture Schedule</a></li>
              <li class="active"><a href="/project0/">Project 0</a></li>
              <li class="active"><a href="/project1/">Project 1</a></li>
              <li class="active"><a href="/project2/">Project 2</a></li>
              <li class="active"><a href="/project3/">Project 3</a></li>
              <li class="active"><a href="/project/">Primary Project</a></li></ul>
          </div>
        </div>
      </div>
    </div>


<div class="container container-left">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar well">
  Scalable Internet Services, CS291A, Fall 2019

</div>

<div class="sidebar well">
  <h1 id="course-information">Course Information</h1>

<h4 id="instructor">Instructor</h4>

<p><a href="https://sites.cs.ucsb.edu/~bboe/">Dr. Bryce Boe</a><br />
<a href="mailto:bboe@cs.ucsb.edu">bboe@cs.ucsb.edu</a></p>

<h4 id="class-assistant">Class Assistant</h4>

<p><a href="https://justinppearson.com">Dr. Justin Pearson</a></p>

<h4 id="lecture">Lecture</h4>

<p>Tuesday and Thursday<br />
3:00pm – 4:50pm<br />
<a href="http://mapdev.geog.ucsb.edu/?searchResult=%7B%22tags%22:%22PHELPS%20HALL%203526%20Phelps%20Hall%20PHELP%22,%22fid%22:%2252689%22,%22category%22:%22rooms%22,%22location%22:%22PHELPS%20HALL%203526%22,%22label%22:%22PHELPS%20HALL%203526%22,%22geometry%22:%7B%22type%22:%22polygon%22,%22rings%22:%5B%5B%5B-13341034.4778,4084817.0509%5D,%5B-13341034.4773,4084816.5569%5D,%5B-13341034.4697,4084809.2695%5D,%5B-13341034.4696,4084809.1151%5D,%5B-13341045.2894,4084809.1038%5D,%5B-13341045.2895,4084809.2582%5D,%5B-13341045.4124,4084809.258%5D,%5B-13341045.4131,4084809.9991%5D,%5B-13341045.4145,4084811.2343%5D,%5B-13341045.42,4084816.5454%5D,%5B-13341045.2969,4084816.5456%5D,%5B-13341045.2975,4084817.0396%5D,%5B-13341045.4204,4084817.0395%5D,%5B-13341045.4251,4084821.517%5D,%5B-13341045.4263,4084822.7521%5D,%5B-13341045.428,4084824.327%5D,%5B-13341045.305,4084824.3271%5D,%5B-13341045.3052,4084824.4815%5D,%5B-13341034.4854,4084824.4927%5D,%5B-13341034.4852,4084824.3383%5D,%5B-13341034.4778,4084817.0509%5D%5D%5D,%22_ring%22:0,%22spatialReference%22:%7B%22wkid%22:102100%7D,%22_centroid%22:null,%22_extent%22:%7B%22xmin%22:-13341045.428,%22ymin%22:4084809.1038,%22xmax%22:-13341034.4696,%22ymax%22:4084824.4927,%22spatialReference%22:%7B%22wkid%22:102100%7D%7D,%22_partwise%22:null%7D%7D&amp;xmin=-13341136&amp;ymin=4084737&amp;xmax=-13340944&amp;ymax=4084897">Phelps 3526</a></p>

<h4 id="lab">Lab</h4>

<p>Tuesday<br />
12pm – 1pm or 1pm – 2pm<br />
<a href="http://mapdev.geog.ucsb.edu/?searchResult=%7B%22tags%22:%22PHELPS%20HALL%203525%20Phelps%20Hall%20PHELP%22,%22fid%22:%2252693%22,%22category%22:%22rooms%22,%22location%22:%22PHELPS%20HALL%203525%22,%22label%22:%22PHELPS%20HALL%203525%22,%22geometry%22:%7B%22type%22:%22polygon%22,%22rings%22:%5B%5B%5B-13341048.8674,4084821.2355%5D,%5B-13341048.8631,4084817.0359%5D,%5B-13341048.986,4084817.0359%5D,%5B-13341048.9855,4084816.5418%5D,%5B-13341048.8625,4084816.5418%5D,%5B-13341048.858,4084812.0953%5D,%5B-13341048.8567,4084810.8602%5D,%5B-13341048.855,4084809.2545%5D,%5B-13341048.9781,4084809.2543%5D,%5B-13341048.9779,4084809.0999%5D,%5B-13341055.9861,4084809.0926%5D,%5B-13341056.6008,4084809.092%5D,%5B-13341059.7975,4084809.0887%5D,%5B-13341059.7977,4084809.2431%5D,%5B-13341059.8053,4084816.5305%5D,%5B-13341059.8058,4084817.0246%5D,%5B-13341059.8134,4084824.3119%5D,%5B-13341059.8135,4084824.4663%5D,%5B-13341048.9937,4084824.4776%5D,%5B-13341048.9936,4084824.3232%5D,%5B-13341048.8706,4084824.3234%5D,%5B-13341048.8686,4084822.4706%5D,%5B-13341048.8674,4084821.2355%5D%5D%5D,%22_ring%22:0,%22spatialReference%22:%7B%22wkid%22:102100%7D,%22_centroid%22:null,%22_extent%22:%7B%22xmin%22:-13341059.8135,%22ymin%22:4084809.0887,%22xmax%22:-13341048.855,%22ymax%22:4084824.4776,%22spatialReference%22:%7B%22wkid%22:102100%7D%7D,%22_partwise%22:null%7D%7D&amp;xmin=-13341150&amp;ymin=4084737&amp;xmax=-13340959&amp;ymax=4084897">Phelps 3525</a></p>

<h4 id="final-presentations">Final Presentations</h4>

<p>Thursday December 12<br />
4pm – 7pm<br />
<a href="http://mapdev.geog.ucsb.edu/?searchResult=%7B%22tags%22:%22PHELPS%20HALL%203526%20Phelps%20Hall%20PHELP%22,%22fid%22:%2252689%22,%22category%22:%22rooms%22,%22location%22:%22PHELPS%20HALL%203526%22,%22label%22:%22PHELPS%20HALL%203526%22,%22geometry%22:%7B%22type%22:%22polygon%22,%22rings%22:%5B%5B%5B-13341034.4778,4084817.0509%5D,%5B-13341034.4773,4084816.5569%5D,%5B-13341034.4697,4084809.2695%5D,%5B-13341034.4696,4084809.1151%5D,%5B-13341045.2894,4084809.1038%5D,%5B-13341045.2895,4084809.2582%5D,%5B-13341045.4124,4084809.258%5D,%5B-13341045.4131,4084809.9991%5D,%5B-13341045.4145,4084811.2343%5D,%5B-13341045.42,4084816.5454%5D,%5B-13341045.2969,4084816.5456%5D,%5B-13341045.2975,4084817.0396%5D,%5B-13341045.4204,4084817.0395%5D,%5B-13341045.4251,4084821.517%5D,%5B-13341045.4263,4084822.7521%5D,%5B-13341045.428,4084824.327%5D,%5B-13341045.305,4084824.3271%5D,%5B-13341045.3052,4084824.4815%5D,%5B-13341034.4854,4084824.4927%5D,%5B-13341034.4852,4084824.3383%5D,%5B-13341034.4778,4084817.0509%5D%5D%5D,%22_ring%22:0,%22spatialReference%22:%7B%22wkid%22:102100%7D,%22_centroid%22:null,%22_extent%22:%7B%22xmin%22:-13341045.428,%22ymin%22:4084809.1038,%22xmax%22:-13341034.4696,%22ymax%22:4084824.4927,%22spatialReference%22:%7B%22wkid%22:102100%7D%7D,%22_partwise%22:null%7D%7D&amp;xmin=-13341136&amp;ymin=4084737&amp;xmax=-13340944&amp;ymax=4084897">Phelps 3526</a></p>

<h4 id="resources">Resources</h4>

<p><a href="https://piazza.com/ucsb/fall2019/cs291a">Piazza</a> (class discussion)</p>

<p><a href="https://www.awseducate.com/Registration?apptype=student&amp;courseview=true">AWS Educate</a></p>

<p><a href="https://github.com/scalableinternetservices">Github</a></p>

<h4 id="textbooks">Textbooks</h4>

<p><a href="https://www.railstutorial.org/">The Ruby On Rails Tutorial</a><br />
<em><a href="https://www.railstutorial.org/book">Available online</a>.</em></p>

<p><a href="https://www.amazon.com/High-Performance-Browser-Networking-performance/dp/1449344763">High Performance Browser Networking</a><br />
ISBN: 9781449344764<br />
<em><a href="https://hpbn.co/">Available online</a>.</em>
Note: The online version is slightly more up-to-date.</p>

</div>

    </div>
    <div class="col-md-9">
      <h1 id="project-2-docker-sinatra-and-googles-cloud-run">Project 2: Docker, Sinatra and Google’s Cloud Run</h1>

<p>In this project you will write a <a href="http://sinatrarb.com/">Sinatra</a> application,
built it into a <a href="https://www.docker.com/products/docker-desktop">Docker</a>
container, and deploy it <a href="https://cloud.google.com/run/">Google Cloud
Run</a>. This service will provide a simple rest
interface over a distributed storage system, Google Cloud Storage (GCS), where
your application can create, list, read, and delete files.</p>

<h2 id="learning-outcomes">Learning Outcomes:</h2>

<ul>
  <li>
    <p>Student can perform create, read, and delete actions using Google Cloud
Storage.</p>
  </li>
  <li>
    <p>Student has written a Sinatra web application with four API endpoints.</p>
  </li>
  <li>
    <p>Student has built a docker container.</p>
  </li>
  <li>
    <p>Student has deployed code to Google Cloud Run.</p>
  </li>
  <li>
    <p>Student has compared the performance of Google Cloud Run to that of AWS
Lambda.</p>
  </li>
</ul>

<h2 id="due-date">Due Date</h2>

<p>Tuesday October 15, 10:59:59 AM PDT</p>

<h2 id="overview-video">Overview Video</h2>

<p>Coming soon!</p>

<h2 id="project-submission">Project Submission</h2>

<p>Coming soon!</p>

<h2 id="http-api-specification">HTTP API Specification</h2>

<p>The following describes the HTTP API endpoints that you are to implement. The
template project provides only <code class="highlighter-rouge">GET /</code> that returns <code class="highlighter-rouge">Hello World</code>.</p>

<h3 id="get-">GET /</h3>

<p>This endpoint is simply used to redirect the client.</p>

<ul>
  <li>Reponds with <code class="highlighter-rouge">302</code> redirect to <code class="highlighter-rouge">/files/</code>.</li>
</ul>

<p>Example curl command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-D-</span> URL_BASE
</code></pre></div></div>

<p>Example HTTP response:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">location</span><span class="p">:</span> <span class="s">URL_BASE/files/</span>
</code></pre></div></div>

<h3 id="get-files">GET /files/</h3>

<p>This endpoint is used to get a list of files available in the GCS bucket.</p>

<ul>
  <li>Responds <code class="highlighter-rouge">200</code> with a JSON body containing a sorted list of valid SHA256
digests in sorted order (lexicographically ascending).</li>
</ul>

<p>Example curl command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-D-</span> URL_BASE/files/
</code></pre></div></div>

<p>Example HTTP response:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">content-type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">202</span>

<span class="p">[</span><span class="s2">"02818fde32cc125a69bf5bdd2d1c1f615dee26984801ad3558cb7c71a54bc6ac"</span><span class="p">,</span><span class="s2">"c36e18b713bf317e08e2afce764bf7e17457be9e22538efb39a9f0d036f7c6cc"</span><span class="p">,</span><span class="s2">"fbcfc39ad67a080b85f914d3c37b10f6b814133fc1fcc321ac8c7e85cf42bc60"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h3 id="post-files">POST /files/</h3>

<p>This endpoint is used to upload a file to GCS.</p>

<ul>
  <li>
    <p>On success, respond <code class="highlighter-rouge">201</code> with a JSON body that encompasses the uploaded
file’s hex digest (see example below)</p>
  </li>
  <li>
    <p>Respond <code class="highlighter-rouge">409</code> if a file with the same SHA256 hex digest has already been
uploaded.</p>
  </li>
  <li>
    <p>Respond <code class="highlighter-rouge">422</code> if:</p>

    <ul>
      <li>
        <p>there isn’t a file provided as the <code class="highlighter-rouge">file</code> parameter</p>
      </li>
      <li>
        <p>the provided file is more than <code class="highlighter-rouge">1MB</code> in size</p>
      </li>
    </ul>
  </li>
</ul>

<p>Example curl command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-D-</span> URL_BASE/files/ <span class="nt">-F</span> <span class="s1">'file=@test.txt'</span>
</code></pre></div></div>

<p>Example HTTP response:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">content-type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">79</span>

<span class="p">{</span><span class="nl">"uploaded"</span><span class="p">:</span><span class="s2">"3fd48de5c648bce27acaa6ddda51f35a0c69f07075ac472a4347c66502bb0d48"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="get-filesdigest">GET /files/{DIGEST}</h3>

<ul>
  <li>
    <p>On success, respond <code class="highlighter-rouge">200</code> and:</p>

    <ul>
      <li>
        <p>the <code class="highlighter-rouge">Content-Type</code> header should be set to that provided when the file
was uploaded</p>
      </li>
      <li>
        <p>the body should contain the contents of the file</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Respond <code class="highlighter-rouge">404</code> if there is no file corresponding to <code class="highlighter-rouge">DIGEST</code>.</p>
  </li>
  <li>
    <p>Respond <code class="highlighter-rouge">422</code> if <code class="highlighter-rouge">DIGEST</code> is not a valid SHA256 hex digest.</p>
  </li>
</ul>

<p>Example curl command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-D-</span> URL_BASE/files/3fd48de5c648bce27acaa6ddda51f35a0c69f07075ac472a4347c66502bb0d48
</code></pre></div></div>

<p>Example HTTP response:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">content-type</span><span class="p">:</span> <span class="s">text/plain;charset=utf-8</span>
<span class="na">content-disposition</span><span class="p">:</span> <span class="s">attachment; filename="3fd48de5c648bce27acaa6ddda51f35a0c69f07075ac472a4347c66502bb0d48"</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">10</span>

Test File
</code></pre></div></div>

<h3 id="delete-filesdigest">DELETE /files/{DIGEST}</h3>

<p>Delete the file represented by <code class="highlighter-rouge">DIGEST</code>.</p>

<ul>
  <li>
    <p>Respond <code class="highlighter-rouge">422</code> if <code class="highlighter-rouge">DIGEST</code> is not a valid SHA256 hex digest.</p>
  </li>
  <li>
    <p>Respond 200 in all other cases (recall that HTTP <code class="highlighter-rouge">DELETE</code> should be
idempotent).</p>
  </li>
</ul>

<p>Example curl command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-D-</span> <span class="nt">-X</span> DELETE URL_BASE/files/3fd48de5c648bce27acaa6ddda51f35a0c69f07075ac472a4347c66502bb0d48
</code></pre></div></div>

<p>Example HTTP response:</p>

<pre><code class="language-HTTP">HTTP/1.1 200 OK
</code></pre>

<h2 id="storage-requirements">Storage Requirements</h2>

<p>Files are to be saved to the GCS bucket <code class="highlighter-rouge">cs291_project2</code> associated with the
project ID <code class="highlighter-rouge">cs291-f19</code>. The following ruby code provides an example for
obtaining a Bucket object:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'google/cloud/storage'</span>
<span class="n">storage</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="o">::</span><span class="no">Storage</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">project_id: </span><span class="s1">'cs291-f19'</span><span class="p">)</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s1">'cs291_project2'</span><span class="p">,</span> <span class="ss">skip_lookup: </span><span class="kp">true</span>
</code></pre></div></div>

<p>Uploaded files are to be saved into GCS using object names derived from the
SHA256 hex digest of the file’s contents.</p>

<p>For example, the follow shows a file, <code class="highlighter-rouge">test.txt</code>, that has a SHA256 hex digest of
<code class="highlighter-rouge">3fd48de5c648bce27acaa6ddda51f35a0c69f07075ac472a4347c66502bb0d48</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Test File"</span> <span class="o">&gt;</span> test.txt
<span class="nv">$ </span><span class="nb">sha256sum </span>test.txt
3fd48de5c648bce27acaa6ddda51f35a0c69f07075ac472a4347c66502bb0d48  test.txt
</code></pre></div></div>

<p>The object name for the above file to store in GCS should be
<code class="highlighter-rouge">3f/d4/8de5c648bce27acaa6ddda51f35a0c69f07075ac472a4347c66502bb0d48</code>. In
particular we twice separate out two consecutive digits of the hex
digest. While this is an implementation specific detail that has no impact on
the external view of your API, it is important that this pattern is utilized.</p>

<h2 id="resources">Resources</h2>

<h3 id="project-template">Project Template</h3>

<p><a href="https://github.com/scalableinternetservices/cs291a_project2_template">https://github.com/scalableinternetservices/cs291a_project2_template</a></p>

<p>Please review the template project README for development and deployment instructions.</p>

<h3 id="verification-script">Verification Script</h3>

<p>Please use the following script to verify your web application:
<a href="https://github.com/scalableinternetservices/ucsb_website/tree/master/scripts#project-2-verification-script">https://github.com/scalableinternetservices/ucsb_website/tree/master/scripts#project-2-verification-script</a></p>

<h2 id="required-tools">Required Tools:</h2>

<ul>
  <li>
    <p><a href="https://www.docker.com/products/docker-desktop">Docker</a></p>
  </li>
  <li>
    <p><a href="https://cloud.google.com/run/">Google Cloud Run</a></p>
  </li>
  <li>
    <p><a href="https://googleapis.dev/ruby/google-cloud-storage/latest/index.html">Google Cloud
Storage</a></p>
  </li>
  <li>
    <p><a href="https://www.ruby-lang.org/en/">Ruby</a></p>
  </li>
  <li>
    <p><a href="http://sinatrarb.com/">Sinatra</a></p>
  </li>
</ul>

<h2 id="other-resources">Other Resources:</h2>

<ul>
  <li>
    <p><a href="https://cloud.google.com/sdk/docs/#install_the_latest_cloud_tools_version_cloudsdk_current_version">Google Cloud
Tools</a></p>
  </li>
  <li>
    <p><a href="https://cloud.google.com/run/docs/quickstarts/build-and-deploy">Google Cloud Run Quick
Start</a> (in
case you want to look at doing this from scratch)</p>
  </li>
</ul>

    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span12 footer navbar-inverse navbar-fixed-bottom">
      <p class="copyright">&copy;2019
        <a href="https://bryceboe.com">Bryce Boe</a>.
      </p>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

</body>

</html>

