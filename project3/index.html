<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Scalable Internet Services</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  </head>

  <body>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Scalable Internet Services</a>
          </div>
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/schedule/">Class Schedule</a></li>
              <li class="active"><a href="/project0/">Project 0</a></li>
              <li class="active"><a href="/project1/">Project 1</a></li>
              <li class="active"><a href="/project2/">Project 2</a></li>
              <li class="active"><a href="/project3/">Project 3</a></li>
              <li class="active"><a href="/project/">Primary Project</a></li></ul>
          </div>
        </div>
      </div>
    </div>


<div class="container container-left">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar">
  <h1 id="course-info">Course Info</h1>

<ul>
  <li>Course Number: CS291A</li>
  <li>Quarter: Fall 2021</li>
</ul>

<h2 id="instructor">Instructor</h2>

<ul>
  <li><a href="https://www.linkedin.com/in/bryceboe/">Dr. Bryce Boe</a></li>
  <li><a href="mailto:bboe@cs.ucsb.edu">bboe@cs.ucsb.edu</a></li>
</ul>

<h2 id="appfolio-backup">AppFolio Backup</h2>

<ul>
  <li><a href="https://www.linkedin.com/in/nevenagolubovic/">Dr. Nevena Golubovic</a></li>
  <li><a href="mailto:nevena.golubovic@appfolio.com">nevena.golubovic@appfolio.com</a></li>
</ul>

<p>Please use <a href="https://piazza.com/ucsb/fall2021/cs291a">Piazza</a> for class-related correspondance.</p>

<h2 id="dates">Dates</h2>

<h3 id="classes">Classes</h3>

<ul>
  <li>Tuesday and Thursday</li>
  <li>3:00pm – 4:50pm PST</li>
  <li>Phelps 3526</li>
</ul>

<h3 id="initial-tasks-due-before">Initial tasks due before</h3>

<p>Friday, September 24 10am PDT</p>

<ul>
  <li>Complete the <a href="https://forms.gle/h8N5ymVe5ofYA9MK9">introduction survey</a></li>
  <li>Join the class on <a href="https://piazza.com/ucsb/fall2021/cs291a">Piazza</a>
<!-- - Enroll in [AWS Educate](https://www.awseducate.com/Registration?apptype=student&courseview=true) --></li>
</ul>

<h3 id="project-0project0-due-before"><a href="/project0/">Project 0</a> due before</h3>

<p>Monday, September 27 1pm PDT</p>

<h3 id="project-1project1-due-before"><a href="/project1/">Project 1</a> due before</h3>

<p>Friday, October 1 1pm PDT</p>

<h3 id="project-2project2-due-before"><a href="/project2/">Project 2</a> due before</h3>

<p>Friday, October 8 1pm PDT</p>

<h3 id="project-3-pairing-message-due-before">Project 3 Pairing Message due before</h3>

<p>Friday, October 15 9am PDT</p>

<h3 id="project-3project3-due-before"><a href="/project3/">Project 3</a> due before</h3>

<p>Friday, October 22 9am PDT</p>

<h3 id="projectprojectreport-report-due-before"><a href="/project/#report">Project</a> report due before</h3>

<p>Friday, December 3 9am PST</p>

<h3 id="projectprojectvideo-video-due-before"><a href="/project/#video">Project</a> video due before</h3>

<p>Thursday, December 9 4pm PST</p>

<h2 id="class-resources">Class Resources</h2>

<p><a href="https://drive.google.com/drive/folders/17mWzDGfDk1mlNdtblPFWDSmpXVonx9qA">Google Drive</a>: Contains some class content, such as
project overview videos. You must be logged in to your UCSB Google account and
added to a specific Google Group in order to access.</p>

<p><a href="https://piazza.com/ucsb/fall2021/cs291a">Piazza</a>: Use to receive class announcements, ask and
answer questions, and to communicate with instructor. Access code is available
in Google Drive and will be shared in the first class.</p>

<p><a href="https://github.com/scalableinternetservices">Github</a>: Contains content for
this website. Additionally all student projects will live here.</p>

<h2 id="textbooks">Textbooks</h2>

<p><a href="https://www.amazon.com/High-Performance-Browser-Networking-performance/dp/1449344763">High Performance Browser Networking</a><br />
ISBN: 9781449344764<br />
<em><a href="https://hpbn.co/">Available online</a>.</em><br />
Note: The online version is slightly more up-to-date.</p>

<p><a href="https://www.railstutorial.org/book">The Ruby On Rails Tutorial</a><br />
<em><a href="https://3rd-edition.railstutorial.org/book">Complete 3rd edition available online</a></em><br />
Note: This book is only useful once we get to the primary project.</p>


</div>

    </div>
    <div class="col-md-9">
      <h1 id="project-3-chat-server-and-corresponding-react-front-end">Project 3: Chat Server and Corresponding React Front-End</h1>

<p>In this project you will write a chat server using the Sinatra framework, as
well as a stand-alone React front-end for your chat sever. The server will be
packaged into a Docker container.</p>

<p>Your front-end should have the capability to seamlessly work with both your
server, and my deployed version of the server (reference server). Similarly my
deployed front-end (reference client) should be able to seamlessly interact
with your server.</p>

<hr />

<h2 id="working-in-pairs-optional">Working in Pairs (optional)</h2>

<p>This project is significantly more complex than the previous projects. You will
need to maintain state in your Sinatra application, and many of you will learn
an entirely new framework, React. I estimate this project to be more than four
times the work of <a href="/project2/">Project 2</a>. As a result, this project spans two
weeks, and you have the option of working with another student of the course.</p>

<p>If you will work in a pair, please have one member of your pair send a private
message to me on Piazza with both members’ names to indicate that the two of
you will work together. Once you’ve formed a pair, you and your partner are
committing to stick with the pairing.</p>

<p>If you intend to work solo, please also message me on Piazza to indicate your
choice to work solo. Should you change your mind, you may later pair up with
someone by the pairing deadline.</p>

<p>The pairing deadline is listed in the side bar.</p>

<hr />

<h2 id="learning-outcomes">Learning Outcomes</h2>

<ul>
  <li>
    <p>Student has written and deployed a React application coded using JSX.</p>
  </li>
  <li>
    <p>Student has added CORS headers to their web application to support
third-party front-ends.</p>
  </li>
  <li>
    <p>Student has leveraged Server-Sent Events and JavaScript’s EventSource to
provide a real-time communication platform.</p>
  </li>
</ul>

<hr />

<h2 id="overview-video">Overview Video</h2>

<p><a href="https://youtu.be/FutR00lpAfE">https://youtu.be/FutR00lpAfE</a></p>

<p>Note: This video is for a former version of this project. The specification has
slightly changed.</p>

<hr />

<h2 id="template-project">Template Project</h2>

<p>Please create a new private repository from this template:</p>

<p><a href="https://github.com/scalableinternetservices/cs291a_project3_template/generate">https://github.com/scalableinternetservices/cs291a_project3_template/generate</a></p>

<hr />

<h2 id="project-submission">Project Submission</h2>

<p>Please have each team member submit the following form:</p>

<p><a href="https://forms.gle/RUyjZxor1U9JzGuA9">https://forms.gle/RUyjZxor1U9JzGuA9</a></p>

<h3 id="deliverables">Deliverables</h3>

<p>In order to submit the form you will need three additional things:</p>

<ul>
  <li>
    <p>The name of a pushed docker container that when invoked runs your chat
server, e.g., <code class="language-plaintext highlighter-rouge">us.gcr.io/cs291a/project3_YOURNAME</code></p>
  </li>
  <li>
    <p>A URL to your deployed front-end application with minimized JavaScript (tip:
<code class="language-plaintext highlighter-rouge">yarn build</code>).</p>
  </li>
  <li>
    <p>A URL to your GitHub repository. Assuming this repository is <code class="language-plaintext highlighter-rouge">private</code>,
please invite me, <code class="language-plaintext highlighter-rouge">bboe</code> on GitHub so that I can see your code.</p>
  </li>
</ul>

<p class="alert alert-danger"><strong>Note</strong>: Please do not deploy this project to Google Cloud Run. First, it
won’t work as expected because Google Cloud Run has a maximum connection
timeout. Second, I will run your docker containers locally.</p>

<hr />

<h2 id="http-api-specification">HTTP API Specification</h2>

<p>You will need to implement the following endpoints for this project.</p>

<p class="alert alert-warning"><strong>Note</strong>: I’ve intentionally excluded any CORS related headers and endpoints
from the following list. It’s up to you to determine the necessary CORs
endpoints.</p>

<h3 id="post-login">POST /login</h3>

<p>This endpoint is used to grant a user an access token. The endpoint is also
used to immediately register a new user. Once a user has been created, they
must login with the same password. The server should store the user
registrations in memory.</p>

<p>Returns:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">201</code> with the JSON body <code class="language-plaintext highlighter-rouge">{"message_token": &lt;SIGNED MESSAGE TOKEN&gt;,
"stream_token": &lt;SIGNED STREAM TOKEN&gt;}</code> on success. The server should
invalidate any previous <code class="language-plaintext highlighter-rouge">message_token</code> and <code class="language-plaintext highlighter-rouge">stream_token</code> values assigned to
the user, resulting in new tokens for each succesful login. No other <code class="language-plaintext highlighter-rouge">/login</code>
response status code should reset the tokens.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">403</code> if the provided <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">password</code> combination does not match
that of an existing user</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">409</code> if there is already a <code class="language-plaintext highlighter-rouge">stream</code> open for the <code class="language-plaintext highlighter-rouge">username</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">422</code> if either <code class="language-plaintext highlighter-rouge">password</code> or <code class="language-plaintext highlighter-rouge">username</code> is blank</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">422</code> if the set of provided fields do not exactly match the two expected
fields</p>
  </li>
</ul>

<p>Expected Request Form Fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">password</code>: the password associated with <code class="language-plaintext highlighter-rouge">username</code></li>
  <li><code class="language-plaintext highlighter-rouge">username</code>: the name of the user’s account in the system</li>
</ul>

<p>Example curl command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-D-</span> &lt;BASE_URL&gt;/login <span class="nt">-F</span> <span class="nv">username</span><span class="o">=</span>&lt;USERNAME&gt; <span class="nt">-F</span> <span class="nv">password</span><span class="o">=</span>&lt;PASSWORD&gt;
</code></pre></div></div>

<p>Example HTTP response:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">CREATED</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="nl">"message_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SIGNED MESSAGE TOKEN&gt;"</span><span class="p">,</span><span class="w"> </span><span class="nl">"stream_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SIGNED STREAM TOKEN&gt;"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="post-message">POST /message</h3>

<p>Send a message to all users of the chat system.</p>

<p>Returns:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">201</code> on success. Additionally, the <code class="language-plaintext highlighter-rouge">message_token</code> value associated with the
user should be overwritten and the new one returned via the <code class="language-plaintext highlighter-rouge">Token</code> HTTP
response header. This action is to ensure each <code class="language-plaintext highlighter-rouge">message_token</code> may be used
only once.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">403</code> if <code class="language-plaintext highlighter-rouge">&lt;SIGNED MESSAGE TOKEN&gt;</code> is not valid</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">409</code> if there is not a <code class="language-plaintext highlighter-rouge">stream</code> open for the <code class="language-plaintext highlighter-rouge">username</code> associated with the
message token. Additionally, the <code class="language-plaintext highlighter-rouge">message_token</code> value should be rotated in
the same way as described in <code class="language-plaintext highlighter-rouge">201</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">422</code> if <code class="language-plaintext highlighter-rouge">message</code> is blank</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">422</code> if the set of provided fields do not exactly match the expected fields</p>
  </li>
</ul>

<p>Expected Request Headers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Authorization</code> with value <code class="language-plaintext highlighter-rouge">Bearer &lt;SIGNED MESSAGE TOKEN&gt;</code></li>
</ul>

<p>Expected Request Form Fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">message</code>: a string of the message to send</li>
</ul>

<p>Example curl command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-D-</span> &lt;BASE_URL&gt;/message <span class="nt">-F</span> <span class="nv">message</span><span class="o">=</span><span class="nb">test</span> <span class="nt">-H</span> <span class="s2">"Authorization: Bearer &lt;SIGNED MESSAGE TOKEN&gt;"</span>
</code></pre></div></div>

<p>Example HTTP response:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">CREATED</span>
<span class="na">Token</span><span class="p">:</span> <span class="s">&lt;NEW SIGNED MESSAGE TOKEN&gt;</span>
</code></pre></div></div>

<h3 id="get-streamsigned-stream-token">GET /stream/&lt;SIGNED STREAM TOKEN&gt;</h3>

<p>Returns:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">200</code> and begins the <code class="language-plaintext highlighter-rouge">Server-Sent Event</code> stream with events as described the
following section</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">403</code> if <code class="language-plaintext highlighter-rouge">&lt;SIGNED STREAM TOKEN&gt;</code> is not valid</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">409</code> if there is already a <code class="language-plaintext highlighter-rouge">stream</code> open for the <code class="language-plaintext highlighter-rouge">username</code> associated with
the stream token</p>
  </li>
</ul>

<p>Example curl command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-D-</span> &lt;BASE_URL&gt;/stream/&lt;SIGNED STREAM TOKEN&gt;
</code></pre></div></div>

<p>Example (partial) HTTP response:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/event-stream; charset=utf-8</span>

data: {"users": ["curl"], "created": 1570999219.797813}
event: Users
id: 0718299d-43ef-4b1c-b1cf-ba828d195959

data: {"status": "Server start", "created": 1570947584.0895946}
event: ServerStatus
id: ed4e3e63-9680-436d-9ab2-e0546b5cc03f

data: {"message": "We're online!", "user": "bboe", "created": 1570947655.5598643}
event: Message
id: 1a72e044-92e4-4ee5-94fe-5cabacb75b83
</code></pre></div></div>

<div class="alert alert-info">
  <p><strong>Note</strong>: You might be wondering:</p>

  <ul>
    <li>Why do we pass the stream token in the URL of the request?</li>
    <li>Why do we have two separate tokens?</li>
    <li>Why don’t we rotate the stream token, like we do with the message token?</li>
  </ul>

  <p>Those are great questions. In a nutshell, <code class="language-plaintext highlighter-rouge">EventSource</code> does not support
sending arbitrary HTTP headers with the HTTP requests, and it does not support
reading arbitrary HTTP headers from the HTTP response. Additionally the
connection URL cannot be modified after the <code class="language-plaintext highlighter-rouge">EventSource</code> is created. As a
result we cannot:</p>

  <ol>
    <li>pass an <code class="language-plaintext highlighter-rouge">Authorization: Bearer &lt;TOKEN&gt;</code> along with the HTTP request</li>
    <li>extract a newly generated token from the associated HTTP response</li>
    <li>rotate the stream token lest we want to break the <code class="language-plaintext highlighter-rouge">EventSource</code> automatic
reconnect behavior</li>
  </ol>

</div>

<hr />

<h2 id="sse-events">SSE Events</h2>

<p>Below are a list of events that you must support and implement. The <code class="language-plaintext highlighter-rouge">data</code>
field of all events must be JSON. All events have a unique ID which is included
as part of the SSE protocol, and not part of the <code class="language-plaintext highlighter-rouge">data</code> attribute.</p>

<h3 id="disconnect">Disconnect</h3>

<p>Indicates that the server is closing the connection. The browser must not
auto-retry on disconnect.</p>

<p>Fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">created</code> (float): the Unix timestamp when the event was created</li>
</ul>

<h3 id="join">Join</h3>

<p>Indicates that a user has joined the chat.</p>

<p>Fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">created</code> (float): the Unix timestamp when the event was created</li>
  <li><code class="language-plaintext highlighter-rouge">user</code> (string): the username of the user who joined the chat</li>
</ul>

<h3 id="message">Message</h3>

<p>Represents a message from a user connected to the chat.</p>

<p>Fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">created</code> (float): the Unix timestamp when the event was created</li>
  <li><code class="language-plaintext highlighter-rouge">message</code> (string): the message from the user</li>
  <li><code class="language-plaintext highlighter-rouge">user</code> (string): the username of the sender</li>
</ul>

<h3 id="part">Part</h3>

<p>Indicates that a user has left the chat.</p>

<p>Fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">created</code> (float): the Unix timestamp when the event was created</li>
  <li><code class="language-plaintext highlighter-rouge">user</code> (string): the username of the user who left the chat</li>
</ul>

<h3 id="serverstatus">ServerStatus</h3>

<p>Used for the server to provide status updates.</p>

<p>Fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">created</code> (float): the Unix timestamp when the event was created</li>
  <li><code class="language-plaintext highlighter-rouge">status</code> (string): the message from the server</li>
</ul>

<h3 id="users">Users</h3>

<p>Provides a complete list of users connected to the chat server. This message is
only sent out on connection of new streams and not on reconnect where the
<code class="language-plaintext highlighter-rouge">Last-Event-Id</code> header would be present.</p>

<p>Fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">created</code> (float): the Unix timestamp when the event was created</li>
  <li><code class="language-plaintext highlighter-rouge">users</code> (array[string]): the list of connected users</li>
</ul>

<h2 id="server-requirements">Server Requirements</h2>

<ul>
  <li>
    <p>Your server must maintain state about the users who are connected.</p>
  </li>
  <li>
    <p>A broadcast <code class="language-plaintext highlighter-rouge">JOIN</code> should be made any time a user has connected.</p>
  </li>
  <li>
    <p>A broadcast <code class="language-plaintext highlighter-rouge">PART</code> should be made any time a user has disconnected.</p>
  </li>
  <li>
    <p>A <code class="language-plaintext highlighter-rouge">Users</code> event should be sent to each new stream (i.e., not reconnects).</p>
  </li>
  <li>
    <p>Incoming messages should be broadcast to everyone.</p>
  </li>
  <li>
    <p>A <code class="language-plaintext highlighter-rouge">Disconnect</code> should be sent to a user who messages <code class="language-plaintext highlighter-rouge">/quit</code>. Their <code class="language-plaintext highlighter-rouge">POST
/stream/&lt;TOKEN&gt;</code> HTTP response should then be closed by the server.</p>
  </li>
  <li>
    <p>The first event in the server should be <code class="language-plaintext highlighter-rouge">ServerStatus</code> indicating the server
has started.</p>
  </li>
  <li>
    <p>A history of at least the last 100 broadcast events should be kept.</p>
  </li>
  <li>
    <p>All of the <code class="language-plaintext highlighter-rouge">Message</code> or <code class="language-plaintext highlighter-rouge">ServerStatus</code> in the history should be sent to a
newly connecting user (<code class="language-plaintext highlighter-rouge">JOIN</code> and <code class="language-plaintext highlighter-rouge">PART</code> events should not be sent to a newly
connecting user).</p>
  </li>
  <li>
    <p>A user who is reestablishing its connection (retry after failure) should
receive all of the messages in the history that have occurred since the
provided <code class="language-plaintext highlighter-rouge">Last-Event-Id</code> header value. If the value of <code class="language-plaintext highlighter-rouge">Last-Event-Id</code> is not
found in the history, then the connection should be treated as a new
connection.</p>
  </li>
</ul>

<hr />

<h2 id="server-commands">Server Commands</h2>

<p>The following <code class="language-plaintext highlighter-rouge">/</code> commands should be implmented by your server via the <code class="language-plaintext highlighter-rouge">POST
/messages</code> endpoint.</p>

<h3 id="kick-username">/kick &lt;USERNAME&gt;</h3>

<p>Like <code class="language-plaintext highlighter-rouge">/reconnect</code>, but applied to the user respresented by <code class="language-plaintext highlighter-rouge">USERNAME</code>. If there
is no connected user associated with <code class="language-plaintext highlighter-rouge">USERNAME</code>, or a user tries to kick
themselves, the <code class="language-plaintext highlighter-rouge">POST /message</code> HTTP response status should be <code class="language-plaintext highlighter-rouge">409</code>. Because
no <code class="language-plaintext highlighter-rouge">DISCONNECT</code> event is sent, the kicked user’s client’s <code class="language-plaintext highlighter-rouge">EventSource</code>
instance should automatically reconnect to the server.</p>

<h3 id="quit">/quit</h3>

<p>Messages a <code class="language-plaintext highlighter-rouge">DISCONNECT</code> to the sending user, broadcasts a <code class="language-plaintext highlighter-rouge">PART</code> for that user,
and ends their HTTP <code class="language-plaintext highlighter-rouge">stream</code>. The client should not attempt to reconnect.</p>

<h3 id="reconnect">/reconnect</h3>

<p>Broadcasts a <code class="language-plaintext highlighter-rouge">PART</code> for the sending user and ends their HTTP <code class="language-plaintext highlighter-rouge">stream</code>. Because
no <code class="language-plaintext highlighter-rouge">DISCONNECT</code> event is sent, the client’s <code class="language-plaintext highlighter-rouge">EventSource</code> instance should
automatically reconnect to the server.</p>

<hr />

<h2 id="react-front-end-specification">React Front-end Specification</h2>

<p>Your application need not be anything like the reference application. It
however, must meet the following requirements:</p>

<ul>
  <li>
    <p>Connection status should be visually discernible between being connected and
disconnected.</p>
  </li>
  <li>
    <p>There should be an easy way to see who is connected.</p>
  </li>
  <li>
    <p>There should be a way to discover when someone connected (<code class="language-plaintext highlighter-rouge">JOIN</code>).</p>
  </li>
  <li>
    <p>It should be easy to discover when someone disconnected (<code class="language-plaintext highlighter-rouge">PART</code>).</p>
  </li>
  <li>
    <p>New <code class="language-plaintext highlighter-rouge">Message</code> events should be immediately apparent.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ServerStatus</code> events should be discoverable.</p>
  </li>
  <li>
    <p>For retry-able connection failures (e.g., <code class="language-plaintext highlighter-rouge">/reconnect</code>, <code class="language-plaintext highlighter-rouge">/kick</code>), your
application should automatically reconnect (<code class="language-plaintext highlighter-rouge">EventSource</code> should handle this
for you).</p>
  </li>
  <li>
    <p>On <code class="language-plaintext highlighter-rouge">Disconnect</code> your application should not automatically attempt to
reconnect to the server.</p>
  </li>
  <li>
    <p>A user should always be able to take an action (e.g., connect, send
message). In other words there should be no client state that requires a page
refresh.</p>
  </li>
  <li>
    <p>Separate browser windows and/or tabs should each be able to have their own
connection to the server.</p>
  </li>
</ul>

<h3 id="components">Components</h3>

<p>While the names do not need to be the same, you need to at least implement the
following React components:</p>

<ul>
  <li>Compose (a way to input / send a message)</li>
  <li>LoginForm</li>
  <li>MessageList</li>
  <li>UserList</li>
</ul>

<hr />

<h2 id="developing-react-using-docker">Developing React Using Docker</h2>

<p>The following instructions are not necessary, but might make it easier if you
don’t want to set up the dependencies on your machine.</p>

<h3 id="clone-your-copy-of-the-project-3-template-repository">Clone your copy of the project 3 template repository</h3>

<p>Make sure you’ve make a copy of the <a href="./#template-project">template
repository</a>. Then run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone &lt;YOUR_REPO_URI&gt;
<span class="nb">cd</span> &lt;YOUR_REPO_DIRECTORY&gt;
</code></pre></div></div>

<h3 id="run-the-react-development-server">Run the react development server</h3>

<p>Change into the <code class="language-plaintext highlighter-rouge">client</code> directory and start the Docker container by running:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>client
docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">-p</span> 3000:3000 <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/app <span class="nt">-w</span> /app node /bin/bash
</code></pre></div></div>

<p>The above maps local port <code class="language-plaintext highlighter-rouge">3000</code> to container port <code class="language-plaintext highlighter-rouge">3000</code>. Synchronizes the
contents of the current local directory with <code class="language-plaintext highlighter-rouge">/app</code> in the container, and
starts up <code class="language-plaintext highlighter-rouge">bash</code>.</p>

<p>Once in bash, start up the development server:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>chat_client
yarn start
</code></pre></div></div>

<p>Once started, you should be able to access your application via:
<a href="http://localhost:3000">http://localhost:3000</a></p>

<p>This template React client will try to establish a trivial <code class="language-plaintext highlighter-rouge">EventSource</code>
connection to <a href="http://localhost:3001">http://localhost:3001</a> in order to interact with the template
server (view the JavaScript console to see a message on connection).</p>

<h3 id="make-changes">Make Changes</h3>

<p>Locally, edit the contents of files under <code class="language-plaintext highlighter-rouge">client</code> and when you save, you
should see said changes automatically take effect in the browser without
needing to refresh.</p>

<h3 id="react-tutorial">React Tutorial</h3>

<p>Follow this guide to add more components:
<a href="https://reactjs.org/docs/hello-world.html">https://reactjs.org/docs/hello-world.html</a></p>

<hr />

<h2 id="running-the-template-server">Running the Template Server</h2>

<p>In a different terminal, change into the <code class="language-plaintext highlighter-rouge">server</code> directory and then build the
template container:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>server
docker build <span class="nt">-t</span> us.gcr.io/cs291a/project3_<span class="k">${</span><span class="nv">CS291_ACCOUNT</span><span class="k">}</span> <span class="nb">.</span>
</code></pre></div></div>

<p>Then start the the container:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-p</span> 3001:3000 <span class="nt">--name</span> server <span class="nt">--net</span> cs291 <span class="nt">--rm</span> us.gcr.io/cs291a/project3_<span class="k">${</span><span class="nv">CS291_ACCOUNT</span><span class="k">}</span>
</code></pre></div></div>

<p>Note: Ensure you’ve run <code class="language-plaintext highlighter-rouge">docker network create cs291</code> before running the above.</p>

<p>Note that <code class="language-plaintext highlighter-rouge">thin</code> runs on container port 3000, but so does webpacker. Thus we’ll
map host port 3001 to the container port 3000.</p>

<hr />

<h2 id="resources">Resources</h2>

<h3 id="hosted-server-example">Hosted Server Example</h3>

<p><a href="https://chat.cs291.com/">https://chat.cs291.com/</a></p>

<p>The application at the above URL contains a complete server implementation
which your client should be able to communicate with. Of course, the server
side code will not be provided as it’s up to you to replicate its
functionality.</p>

<h3 id="client-example">Client Example</h3>

<p>While the above link also serves a complete client, it’s more interesting to
have a client hosted on a different domain as the interaction then requires
CORS. A copy of the client, with CSS and JavaScript separated can be found at:</p>

<p><a href="https://cs291.com/project3/chat/">https://cs291.com/project3/chat/</a></p>

<p>And, while you can view the source in the browser, it might be more convenient
to see it on GitHub:</p>

<p><a href="https://github.com/scalableinternetservices/ucsb_website/tree/main/project3/chat">https://github.com/scalableinternetservices/ucsb_website/tree/main/project3/chat</a></p>

<p class="alert alert-warning"><strong>Note</strong>: The logic of this client is written 100% in JavaScript and as such it
serves as a poor example of code to copy since you can better accomplish the
same with React. While you may end up writing more code when using React, the
maintainability of the React code is significantly greater, especially when
accompanied with component unit tests.</p>

<hr />

<h2 id="required-tools">Required Tools</h2>

<ul>
  <li>
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource
Sharing</a> (CORS)</p>
  </li>
  <li>
    <p><a href="https://www.docker.com/products/docker-desktop">Docker</a></p>
  </li>
  <li>
    <p><a href="https://reactjs.org/docs/introducing-jsx.html">JSX</a></p>
  </li>
  <li>
    <p>JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource">EventSource</a></p>
  </li>
  <li>
    <p><a href="https://reactjs.org">React</a></p>
  </li>
  <li>
    <p><a href="https://html.spec.whatwg.org/multipage/server-sent-events.html">Server-Sent Events</a> (SSE)</p>
  </li>
  <li>
    <p><a href="http://sinatrarb.com/">Sinatra</a></p>
  </li>
</ul>

<hr />

<h2 id="suggested-reading">Suggested Reading</h2>

<ul>
  <li>
    <p><a href="https://hpbn.co/server-sent-events-sse/">Server-Sent Events (SSE)</a> in High
Performance Browser Networking</p>
  </li>
  <li>
    <p><a href="https://hpbn.co/xmlhttprequest/">XMLHttpRequest</a> in High Performance Browser Networking</p>
  </li>
</ul>

    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span12 footer navbar-inverse navbar-fixed-bottom">
      <p class="copyright">&copy;2021
        <a href="https://www.linkedin.com/in/bryceboe/">Dr. Bryce Boe</a>.
      </p>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

</body>

</html>

